<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/base :: layout(~{::title}, ~{::section}, ~{::script})}">
<head>
    <title>Detail Produk</title>
</head>
<body>
<section>
    <style>
        .product-card { border-radius: 20px; overflow: hidden; background: #fff; }
        .img-container { background-color: #f8f9fa; min-height: 400px; display: flex; align-items: center; justify-content: center; border-radius: 15px; overflow: hidden; position: relative; }
        .stat-box { background: #fdfdfd; border: 1px solid #eee; border-radius: 12px; padding: 15px; }
        .badge-category { background-color: #e0e7ff; color: #4338ca; padding: 0.5em 1em; }
    </style>

    <div class="container py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/products}" class="text-decoration-none text-muted">Produk</a></li>
                <li class="breadcrumb-item active text-dark fw-bold" aria-current="page">Detail</li>
            </ol>
        </nav>

        <!-- Cek apakah product ada -->
        <div th:if="${product != null}" class="card product-card shadow-lg border-0 mx-auto" style="max-width: 1000px;">
            <div class="card-body p-0">
                <div class="row g-0">
                    
                    <!-- KOLOM KIRI: GAMBAR -->
                    <div class="col-lg-5 p-4 d-flex flex-column">
                        <div class="img-container shadow-sm flex-grow-1">
                            <img th:if="${product.image != null}" 
                                 th:src="@{'/uploads/' + ${product.image}}" 
                                 class="img-fluid" style="max-height: 400px; object-fit: contain;" alt="Produk">
                            
                            <div th:unless="${product.image != null}" class="text-center text-secondary opacity-50">
                                <i class="bi bi-camera-fill display-1 mb-2"></i>
                                <p class="mb-0 fw-light">No Image</p>
                            </div>
                        </div>
                        <div class="mt-3 text-center text-muted small">
                            <span class="me-3">ID: <span th:text="${product.id}"></span></span>
                        </div>
                    </div>

                    <!-- KOLOM KANAN: INFO -->
                    <div class="col-lg-7 p-4 p-lg-5 d-flex flex-column justify-content-between">
                        <div>
                            <div class="mb-4">
                                <h1 class="display-6 fw-bold text-dark mb-2" th:text="${product.name}">Nama Produk</h1>
                                <div class="d-flex align-items-center gap-2 text-muted">
                                    <i class="bi bi-clock"></i> 
                                    <!-- PERBAIKAN: Cek null sebelum format tanggal -->
                                    <span>Ditambahkan: 
                                        <span th:text="${product.createdAt != null ? #temporals.format(product.createdAt, 'dd MMMM yyyy') : '-'}"></span>
                                    </span>
                                </div>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-sm-6">
                                    <div class="stat-box h-100">
                                        <small class="text-uppercase text-muted fw-bold">Harga</small>
                                        <div class="d-flex align-items-center mt-1">
                                            <!-- PERBAIKAN: Cek null sebelum format harga -->
                                            <h3 class="text-primary fw-bold mb-0 me-2" 
                                                th:text="${product.price != null ? 'Rp ' + #numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') : 'Rp 0'}">
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="stat-box h-100">
                                        <small class="text-uppercase text-muted fw-bold">Stok</small>
                                        <h3 class="text-dark fw-bold mb-0" th:text="${product.stock != null ? product.stock + ' unit' : '0 unit'}"></h3>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <h6 class="fw-bold text-dark border-bottom pb-2 mb-3">Deskripsi</h6>
                                <p class="text-secondary lh-lg" th:text="${product.description ?: '-'}"></p>
                            </div>
                        </div>

                        <div class="d-flex gap-3 pt-3 border-top mt-auto">
                            <a th:href="@{/products}" class="btn btn-light border">Kembali</a>
                            <a th:href="@{/products/edit/{id}(id=${product.id})}" class="btn btn-primary px-5 shadow-sm ms-auto">Edit</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAMPILAN JIKA DATA NULL/ERROR -->
        <div th:unless="${product != null}" class="alert alert-danger text-center shadow-sm">
            <h4><i class="bi bi-exclamation-triangle"></i> Produk Tidak Ditemukan</h4>
            <p>ID produk mungkin salah atau data telah dihapus.</p>
            <a th:href="@{/products}" class="btn btn-secondary mt-2">Kembali ke List</a>
        </div>
    </div>
</section>
<script></script>
</body>
</html>